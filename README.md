<h1>Vulnerability Management with DefectDojo</h1>


<h2>Description</h2>
This lab focuses on using DefectDojo, an open-source vulnerability management platform, to effectively manage and track vulnerabilities within an organization. DefectDojo provides a centralized and collaborative environment for identifying, assessing, and remediating security vulnerabilities in software applications.

During this hands-on lab, participants will gain practical experience in using DefectDojo for vulnerability management. 
<br />


<h2>Languages and Utilities Used</h2>

- <b>Bandit</b>
- <b>ZAP</b>
- <b>DefectDojo</b>

<h2>Environments Used </h2>

- <b>Windows 11</b>
- <b>Linux</b> 

<h2>Program walk-through:</h2>

First, we need to download the source code of the project from our git repository.
Let’s cd into the application so we can scan the app: <br/>
- git clone https://gitlab.practical-devsecops.training/pdso/django.nv webapp<br/>
- cd webapp<br/>
 
<p align="center">
<img src="https://i.imgur.com/tlQA6oh.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

Let’s install the bandit scanner on the system to perform static analysis: <br/>
- pip3 install bandit==1.7.1

<p align="center">
<img src="https://i.imgur.com/jI3JNwt.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

As we have learned in the DevSecOps Gospel, we would like to store the tool results in a JSON file. We are using the tee command here to show the output and store it in a file simultaneously: <br/>
- bandit -r . -f json | tee bandit-output.json

<p align="center">
<img src="https://i.imgur.com/zaVNaMV.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

We have created a simple upload script for you, and you can download this script using the following command: <br/>
- curl https://gitlab.practical-devsecops.training/-/snippets/3/raw -o upload-results.py

<p align="center">
<img src="https://i.imgur.com/76EOtzU.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

Let’s explore what options it provides us: <br/>
- python3 upload-results.py --help

<p align="center">
<img src="https://i.imgur.com/9WWLHEX.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

You can also use the following command to get a token programmatically: <br/>
- export API_KEY=$(curl -s -XPOST -H 'content-type: application/json' https://dojo-rcgsg0ei.lab.practical-devsecops.training/api/v2/api-token-auth/ -d '{"username": "root", "password": "pdso-training"}' | jq -r '.token' )

<p align="center">
<img src="https://i.imgur.com/T9gbANB.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

We can now upload the bandit’s scan output (bandit-output.json) to DefectDojo: <br/>
- python3 upload-results.py --host dojo-rcgsg0ei.lab.practical-devsecops.training --api_key $API_KEY --engagement_id 1 --product_id 1 --lead_id 1 --environment "Production" --result_file bandit-output.json --scanner "Bandit Scan"
  
<p align="center">
<img src="https://i.imgur.com/wCqhjTf.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

Scan the production machine https://prod-rcgsg0ei.lab.practical-devsecops.training with the help of the ZAP docker image owasp/zap2docker-stable:2.10.0, and save the results to /webapp/zap-output.xml: <br/>
           ```docker run --user $(id -u):$(id -g) -w /zap -v $(pwd):/zap/wrk:rw \
           --rm owasp/zap2docker-stable:2.10.0 zap-baseline.py \
           -t https://prod-rcgsg0ei.lab.practical-devsecops.training \
           -d -x zap-output.xml```
  
<p align="center">
<img src="https://i.imgur.com/U7lPq4L.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

Upload the ZAP scan results to Defect Dojo: <br/>
    ```python3 upload-results.py --host dojo-rcgsg0ei.lab.practical-devsecops.training \
    --api_key $API_KEY --engagement_id 1 --product_id 1 \
    --lead_id 1 --environment "Production" \
    --result_file /webapp/zap-output.xml \
    --scanner "ZAP Scan"```
  
<p align="center">
<img src="https://i.imgur.com/Ei3yfWG.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />

Here are the results in DefectDojo: <br/>
  
<p align="center">
<img src="https://i.imgur.com/sXrEB1u.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
<img src="https://i.imgur.com/0rZ3mfB.png" height="80%" width="80%" alt="Disk Sanitization Step"/>
</p>

<br />
<br />
<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
